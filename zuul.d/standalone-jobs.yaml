---
# zuul.d/standalone-jobs.yaml
# Zuul layout for TripleO standalone jobs.
# It contains all the jobs related to standalone installer testing.

- job:
    name: tripleo-ci-base-required-projects-standalone-upstream
    description: |
      Base abstract job to add required-projects for Upstream Standalone jobs
    abstract: true
    parent: tripleo-ci-base-standalone-standard
    required-projects: &standalone_rq
      - opendev.org/openstack/tripleo-ansible
      - opendev.org/openstack/tripleo-operator-ansible
      - name: opendev.org/openstack/ansible-config_template
        override-checkout: master

- job:
    name: tripleo-ci-base-required-projects-edpm-upstream
    description: |
      Base abstract job to add required-projects for Upstream edpm jobs
    abstract: true
    parent: tripleo-ci-base-multinode-edpm-standard
    required-projects: *standalone_rq

# Centos 8 base jobs
- job:
    name: tripleo-ci-base-standalone-centos-8
    abstract: true
    description: |
      Base abstract job for standalone TripleO CI Centos-8 zuulv3 jobs.
    parent: tripleo-ci-base-required-projects-standalone-upstream
    nodeset: single-centos-8-node

# CentOS - 9 base jobs
- job:
    name: tripleo-ci-base-standalone-centos-9
    abstract: true
    description: |
      Base abstract job for standalone TripleO CI Centos-9 zuulv3 jobs.
    parent: tripleo-ci-base-required-projects-standalone-upstream
    nodeset: single-centos-9-node

- job:
    name: tripleo-ci-base-edpm-centos-9
    abstract: true
    description: |
      Base abstract job for standalone TripleO CI Centos-9 zuulv3 jobs.
    parent: tripleo-ci-base-required-projects-edpm-upstream
    nodeset: two-centos-9-nodes

# ATTENTION: Try to avoid adding irrelevant-files inside templates
# or project because it does override values defined at job level.
# An attempt to optimize at this level can have the exactly opposite effect,
# triggering the affected jobs on far more changes than needed.
# Keep vanilla standalone during c8/wallaby teardown
- job:
    name: tripleo-ci-centos-8-standalone
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(stable/(wallaby)).*$
    vars:
      featureset: '052'
    irrelevant-files: &irrelevant_files
      - .*molecule.*
      - ^.*\.md$
      - ^.*\.rst$
      - ^.ansible-lint$
      - ^.pre-commit-config.yaml$
      - ^Puppetfile.*$
      - ^doc/.*$
      - ^etc/.*$
      - ^lower-constraints.txt$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^spec/.*$
      - ^test-requirements.txt$
      - ^vars/sova-patterns.yml$
      - tox.ini
      - ^setup.*$
      - ^tripleoclient/tests/.*$
      - ^tripleo_common/tests/.*$

- job:
    name: tripleo-ci-centos-9-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: &c9_branches ^(stable/wallaby).*$
    vars:
      containers_base_image: registry.access.redhat.com/ubi9:latest
      featureset: '052'
    irrelevant-files: *irrelevant_files

- job:
    name: tripleo-ci-centos-8-standalone-build
    parent: tripleo-ci-centos-8-standalone
    vars:
      build_container_images: true
    files: &sa_build_files
      - config/release/tripleo-ci/.*
      - roles/standalone/.*
      - roles/build-containers/.*
      - roles/container-build/.*
      - roles/container-prep/.*
      - roles/container-update/.*
      - roles/extras-common/.*

- job:
    name: tripleo-ci-centos-9-standalone-build
    parent: tripleo-ci-centos-9-standalone
    vars:
      build_container_images: true
    files: *sa_build_files

- project-template:
    name: tripleo-standalone-scenarios-pipeline
    queue: tripleo
    check:
      jobs:
        - tripleo-ci-centos-9-content-provider:
            irrelevant-files: *irrelevant_files
        - tripleo-ci-centos-9-scenario001-standalone: &c9_scen1
            branches: *c9_branches
            files: &scen1_files
              # tripleo-common
              - ^container-images/tcib/base/collectd.*$
              - ^container-images/tcib/base/os/aodh.*$
              - ^container-images/tcib/base/os/ceilometer.*$
              - ^container-images/tcib/base/os/cinder.*$
              - ^container-images/tcib/base/os/gnocchi.*$
              - ^container-images/tcib/base/os/heat.*$
              - ^container-images/tcib/base/os/horizon.*$
              - ^container-images/tcib/base/qdrouterd.*$
              - ^container-images/tcib/base/rabbitmq.*$
              - ^container-images/tcib/base/redis.*$
              - ^tripleo_common/image/.*$
              - workbooks/ceph-ansible.yaml
              - tripleo_common/actions/ansible.py
              # python-tripleoclient
              - ^tripleoclient/utils.py$
              - ^tripleoclient/v2/overcloud_ceph.py$
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*aodh.*$
              - ^((docker|puppet)/services|deployment)/.*ceilometer.*$
              - ^((docker|puppet)/services|deployment)/.*ceph.*$
              - ^((docker|puppet)/services|deployment)/.*cinder.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*gnocchi.*$
              - ^((docker|puppet)/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^((docker|puppet)/services|deployment)/.*heat.*$
              - ^((docker|puppet)/services|deployment)/.*horizon.*$
              - ^((docker|puppet)/services|deployment)/.*logging.*$
              - ^((docker|puppet)/services|deployment)/.*metrics.*$
              - ^((docker|puppet)/services|deployment)/.*monitoring.*$
              - ^((docker|puppet)/services|deployment)/.*panko.*$
              - ^((docker|puppet)/services|deployment)/.*placement.*$
              - ^((docker|puppet)/services|deployment)/database/redis.*$
              - ci/environments/scenario001-standalone.yaml
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/certmonger/ceph.*$  # ceph dashboard
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/aodh.*$
              - ^manifests/profile/(base|pacemaker)/ceilometer.*$
              - ^manifests/profile/(base|pacemaker)/cinder.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/gnocchi.*$
              - ^manifests/profile/(base|pacemaker)/heat.*$
              - ^manifests/profile/(base|pacemaker)/horizon.*$
              - ^manifests/profile/(base|pacemaker)/logging.*$
              - ^manifests/profile/(base|pacemaker)/metrics.*$
              - ^manifests/profile/(base|pacemaker)/monitoring.*$
              - ^manifests/profile/(base|pacemaker)/panko.*$
              - ^manifests/profile/(base|pacemaker)/placement.*$
              - ^manifests/profile/(base|pacemaker)/database/redis.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/ci-common-vars/.*
              - roles/prepare-node/.*
              - roles/ceph-loop-device/.*  # scen1/4 ceph
              # tripleo-ansible
              - ^tripleo_ansible/roles/tripleo_ceph.*/.*
              - ^tripleo_ansible/roles/tripleo_hieradata/.*
              - ^tripleo_ansible/roles/tripleo_podman/.*
              - ^tripleo_ansible/roles/tripleo_upgrade_hiera/.*
              - ^tripleo_ansible/roles/tripleo_lvmfilter/.*
              - ^setup.*
            vars: &consumer_vars
              consumer_job: true
              build_container_images: false
              remove_tags:
                - build
            dependencies:
              - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-scenario002-standalone: &c9_scen2
            <<: *c9_scen1
            files: &scen2_files
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*aodh.*$
              - ^((docker|puppet)/services|deployment)/.*barbican.*$
              - ^((docker|puppet)/services|deployment)/.*ceilometer.*$
              - ^((docker|puppet)/services|deployment)/.*cinder.*$
              - ^((docker|puppet)/services|deployment)/.*ec2-api.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*gnocchi.*$
              - ^((docker|puppet)/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^((docker|puppet)/services|deployment)/.*iscsid.*$
              - ^((docker|puppet)/services|deployment)/.*panko.*$
              - ^((docker|puppet)/services|deployment)/.*swift.*$
              - ^((docker|puppet)/services|deployment)/.*zaqar.*$
              - ^((docker|puppet)/services|deployment)/database/redis.*$
              - ci/environments/scenario002-standalone.yaml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/aodh.*$
              - ^manifests/profile/(base|pacemaker)/barbican.*$
              - ^manifests/profile/(base|pacemaker)/ceilometer.*$
              - ^manifests/profile/(base|pacemaker)/cinder.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/gnocchi.*$
              - ^manifests/profile/(base|pacemaker)/iscsid.*$
              - ^manifests/profile/(base|pacemaker)/nova/ec2.*$
              - ^manifests/profile/(base|pacemaker)/panko.*$
              - ^manifests/profile/(base|pacemaker)/swift.*$
              - ^manifests/profile/(base|pacemaker)/zaqar.*$
              - ^manifests/profile/(base|pacemaker)/database/redis.*$
              # tripleo-ansible
              - ^tripleo_ansible/roles/tripleo_hieradata/.*
              - ^tripleo_ansible/roles/tripleo_upgrade_hiera/.*
              - ^tripleo_ansible/roles/tripleo_lvmfilter/.*
        - tripleo-ci-centos-9-scenario003-standalone: &c9_scen3
            <<: *c9_scen1
            files: &scen3_files
              # tripleo-common
              - ^container-images/tcib/base/os/designate.*$
              - ^container-images/tcib/base/os/mistral.*$
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*designate.*$
              - ^((docker|puppet)/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^((docker|puppet)/services|deployment)/.*unbound.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*mistral.*$
              - ^((docker|puppet)/services|deployment)/.*nova.*$
              - ci/environments/scenario003-standalone.yaml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/mistral.*$
              - ^manifests/profile/(base|pacemaker)/designate.*$
              - ^manifests/profile/base/neutron/dhcp.pp
              - ^manifests/profile/base/neutron/plugins/ml2/ovn.pp
              # tripleo-ansible
              - ^tripleo_ansible/roles/tripleo_create_admin/.*
              - ^tripleo_ansible/roles/tripleo_hieradata/.*
              - ^tripleo_ansible/roles/tripleo_upgrade_hiera/.*
              - ^tripleo_ansible/roles/tripleo_unbound/.*
              - ^tripleo_ansible/roles/.*designate.*$
              - ^tripleo_ansible/ansible_plugins/modules/tripleo_findif_for_ip.py
        - tripleo-ci-centos-9-scenario004-standalone: &c9_scen4
            <<: *c9_scen1
            files: &scen4_files
              # tripleo-common
              - ^container-images/tcib/base/os/horizon.*$
              - ^container-images/tcib/base/os/manila.*$
              - ^tripleo_common/image/.*$
              # tripleo-heat-templates
              - ^(docker/services|deployment)/ceph.*$
              - ^(docker/services|deployment)/glance.*$
              - ^(docker/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^(docker/services|deployment)/manila.*$
              - ^(docker/services|deployment)/horizon.*$
              - ^((docker|puppet)/services|deployment)/database/mysql.*$
              - ci/environments/scenario004-standalone.yaml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/horizon.*$
              - ^manifests/profile/(base|pacemaker)/manila.*$
              - ^manifests/profile/(base|pacemaker)/ceph.*$  # ceph_nfs / ganesha
              # tripleo-ansible
              - ^tripleo_ansible/roles/tripleo_ceph.*/.*
              # tripleo-quickstart-extras (including standalone ceph)
              - roles/standalone/tasks/.*
        - tripleo-ci-centos-9-scenario007-standalone: &c9_scen7
            <<: *c9_scen1
            files: &scen7_files
              # tripleo-common
              - ^container-images/tcib/base/os/neutron.*$
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^((docker|puppet)/services|deployment)/.*neutron.*$
              - ci/environments/scenario007-standalone.yaml
              # puppet-tripleo
              - ^manifests/haproxy.*$
        - tripleo-ci-centos-9-scenario010-standalone: &c9_scen10
            <<: *c9_scen1
            branches: stable/wallaby
            files: &scen10_files
              # tripleo-common
              - ^container-images/tcib/base/os/horizon.*$
              - ^container-images/tcib/base/os/octavia.*$
              - workbooks/octavia_post.yaml
              - playbooks/octavia-files.yaml
              - playbooks/roles/octavia.*$
              - playbooks/roles/common/.*$
              # tripleo-quickstart
              - config/general_config/featureset062.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/base/database/mysql.*$
              - ^manifests/profile/base/horizon.*$
              - ^manifests/profile/base/octavia.*$
              # tripleo-quickstart-extras (including standalone ceph)
              - roles/standalone/tasks/.*
              - roles/octavia-amphora-download/.*
              # tripleo-heat-templates
              # TODO(beagles): octavia testing touches neutron, glance and nova.
              # It may be sensible to expand this list after it has proven itself.
              - ^(docker/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^(docker/services|deployment)/horizon.*$
              - ^(docker/services|deployment)/octavia.*$
              - ci/environments/scenario010-standalone.yaml
              - ^environments/services/octavia.*.yaml
              - ^deployment/ceph-ansible.*$
              # python-tempestconf
              - ^config_tempest/services/octavia.*$
              # tripleo-ansible
              - ^tripleo_ansible/roles/octavia_.*/.*
              - ^tripleo_ansible/playbooks/octavia.*$
        - tripleo-ci-centos-9-scenario010-ovn-provider-standalone: *c9_scen10
        - tripleo-ci-centos-9-scenario012-standalone: &c9_scen12
            <<: *c9_scen1
            files: &scen12_files
              # tripleo-heat-templates
              - ^(docker/services|deployment)/glance.*$
              - ^(docker/services|deployment)/haproxy-(container|pacemaker)-.*$
              - ^(docker/services|deployment)/ironic.*$
              - ci/environments/scenario012-standalone.yaml
              # tripleo-quickstart
              - config/general_config/featureset060.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/ironic.*$
        - tripleo-ci-centos-9-standalone: &cs9_vars
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-standalone-fips:
            <<: *cs9_vars
            voting: false

    gate:
      jobs:
        - tripleo-ci-centos-9-content-provider:
            irrelevant-files: *irrelevant_files
        - tripleo-ci-centos-9-scenario001-standalone: *c9_scen1
        - tripleo-ci-centos-9-scenario002-standalone: *c9_scen2
        - tripleo-ci-centos-9-scenario003-standalone: *c9_scen3
        - tripleo-ci-centos-9-scenario004-standalone: *c9_scen4
        - tripleo-ci-centos-9-scenario007-standalone: *c9_scen7
        - tripleo-ci-centos-9-scenario010-standalone: *c9_scen10
        - tripleo-ci-centos-9-scenario010-ovn-provider-standalone: *c9_scen10
        - tripleo-ci-centos-9-scenario012-standalone: *c9_scen12
        - tripleo-ci-centos-9-standalone:
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-9-content-provider

- job:
    name: tripleo-ci-scenario012-standalone-options
    vars:
      featureset: '060'
      standalone_ceph: false
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario012-standalone.yaml'

- job:
    name: tripleo-ci-centos-8-scenario012-standalone
    parent: tripleo-ci-scenario012-standalone-options

- job:
    name: tripleo-ci-centos-8-scenario012-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: &c8_branches ^(stable/train).*$

- job:
    name: tripleo-ci-centos-9-scenario012-standalone
    parent: tripleo-ci-scenario012-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario012-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches

# CentOS 8 Jobs
- job:
    name: tripleo-ci-centos-8-scenario000-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: stable/train

- job:
    name: tripleo-ci-scenario000-standalone-options
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario000-standalone.yaml'
        tempest_services:
          - keystone
        tempest_run_concurrency: 1
        tempest_tempest_conf_overrides:
          'auth.tempest_roles': "Member"
        tempest_test_whitelist:
          - 'keystone_tempest_plugin.tests.api.identity.v3'

- job:
    name: tripleo-ci-centos-8-scenario000-standalone
    parent: tripleo-ci-scenario000-standalone-options

- job:
    name: tripleo-ci-centos-8-scenario001-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: *c8_branches

- job:
    name: tripleo-ci-scenario001-standalone-options
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
        tempest_services:
          - aodh
        tempest_run_concurrency: 1
        tempest_tempest_conf_overrides:
          'telemetry.alarm_granularity': '60'
          'auth.tempest_roles': "Member"
        tempest_test_whitelist:
          - 'tempest.api.identity.v3'
          - 'tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern.test_volume_boot_pattern'
          - 'tempest.scenario.test_snapshot_pattern.TestSnapshotPattern.test_snapshot_pattern'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'
          - 'tempest.scenario.test_dashboard_basic_ops'

- job:
    name: tripleo-ci-centos-8-scenario001-standalone
    parent: tripleo-ci-scenario001-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario001-standalone
    parent: tripleo-ci-scenario001-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario001-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    files: *scen1_files

- job:
    name: tripleo-ci-centos-8-scenario002-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: *c8_branches

- job:
    name: tripleo-ci-scenario002-standalone-options
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario002-standalone.yaml'
        tempest_services:
          - barbican
          - ceilometer
          - aodh
        tempest_tempest_conf_overrides:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_extra_config:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_test_whitelist:
          - 'tempest.api.object_storage.test_object_services.ObjectTest'
          - 'barbican_tempest_plugin.tests.scenario.test_volume_encryption.VolumeEncryptionTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningSnapshotTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningTest.test_signed_image_upload_and_boot'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: tripleo-ci-centos-8-scenario002-standalone
    parent: tripleo-ci-scenario002-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario002-standalone
    parent: tripleo-ci-scenario002-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario002-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    files: *scen2_files

- job:
    name: tripleo-ci-centos-8-scenario003-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: *c8_branches

- job:
    name: tripleo-ci-scenario003-standalone-options
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario003-standalone.yaml'
        tempest_services:
          - mistral
          - designate
        tempest_tempest_conf_overrides:
          auth.tempest_roles: "Member"
          dns.nameservers: '1.1.1.1'
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'mistral_tempest_tests.tests.api.v2.test_actions.ActionTestsV2'
          - 'designate_tempest_plugin.tests.api.v2.test_recordset.RecordsetsTest'
          - 'designate_tempest_plugin.tests.api.v2.test_zones.ZonesTest'

- job:
    name: tripleo-ci-centos-8-scenario003-standalone
    parent: tripleo-ci-scenario003-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario003-standalone
    parent: tripleo-ci-scenario003-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario003-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    files: *scen3_files

- job:
    name: tripleo-ci-centos-8-scenario004-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8

- job:
    name: tripleo-ci-scenario004-standalone-options
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_container_cli: podman
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
          - 'environments/podman.yaml'
        tempest_services:
          - manila
        tempest_tempest_conf_overrides:
          'auth.tempest_roles': 'Member'
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'manila_tempest_tests.tests.api.test_shares.SharesNFSTest.test_create_get_delete_share'
          - 'tempest.scenario.test_object_storage_basic_ops'

- job:
    name: tripleo-ci-centos-8-scenario004-standalone
    parent: tripleo-ci-scenario004-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario004-standalone
    parent: tripleo-ci-scenario004-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario004-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    files: *scen4_files

- job:
    name: tripleo-ci-centos-8-scenario007-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: *c8_branches

- job:
    name: tripleo-ci-scenario007-standalone-options
    vars:
      featureset: '052'
      featureset_override:
        run_tempest: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario007-standalone.yaml'
        tempest_services:
          - neutron
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'tempest.scenario.test_minimum_basic.TestMinimumBasicScenario.test_minimum_basic_scenario'
        tempest_private_net_provider_type: 'vxlan'
        use_os_tempest: true

- job:
    name: tripleo-ci-centos-8-scenario007-standalone
    parent: tripleo-ci-scenario007-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario007-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    files: *scen7_files

- job:
    name: tripleo-ci-centos-9-scenario007-standalone
    parent: tripleo-ci-scenario007-standalone-options

- job:
    name: tripleo-ci-scenario010-standalone-options
    vars:
      # using featureset062 is tech debt and should be addressed at a future sprint
      featureset: '062'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'
          - 'ci/environments/octavia-kvm.yaml'

- job:
    name: tripleo-ci-scenario010-ovn-provider-standalone-options
    vars:
      featureset: '062'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        tempest_tempestconf_profile_overrides:
          load_balancer.provider: 'ovn'
          load_balancer.member_role: '"Member"'
          load_balancer.test_reuse_connection: false
          load_balancer.load_balancing_algorithm: 'SOURCE_IP_PORT'
          load_balancer.test_flavors: false
          loadbalancer-feature-enabled.health_monitor_enabled: false
          loadbalancer-feature-enabled.pool_algorithms_enabled: false
          loadbalancer-feature-enabled.l7_protocol_enabled: false
          loadbalancer-feature-enabled.l4_protocol: 'TCP'
          loadbalancer-feature-enabled.session_persistence_enabled: false
          loadbalancer-feature-enabled.not_implemented_is_error: false
          network-feature-enabled.port_security: true
          load_balancer.test_server_path: >-
            "/usr/lib/python{{ [ansible_python.version.major, ansible_python.version.minor] | join('.') }}/site-packages/octavia_tempest_plugin/contrib/test_server/test_server.bin"
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: tripleo-ci-centos-9-scenario010-standalone
    parent: tripleo-ci-scenario010-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario010-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    nodeset: single-centos-9-node-nested-virt
    files: *scen10_files
    vars: &sc010_vars
      tags:
        - build
        - standalone
        - octavia
        - nested-virt

- job:
    name: tripleo-ci-centos-9-scenario010-ovn-provider-standalone
    parent: tripleo-ci-scenario010-ovn-provider-standalone-options

- job:
    name: tripleo-ci-centos-9-scenario010-ovn-provider-standalone
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    nodeset: single-centos-9-node
    files: *scen10_files
    vars: &sc010_ovn_vars
      tags:
        - build
        - standalone
        - octavia

# branched scenario010 based jobs - this will enable the tripleo-ci team
# to enable voting / gating on scenario010 jobs on a per branch basis.

- job:
    name: tripleo-ci-centos-8-scenario010-standalone-train
    parent: tripleo-ci-scenario010-standalone-options

- job:
    name: tripleo-ci-centos-8-scenario010-standalone-train
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    nodeset: single-centos-8-node-nested-virt
    branches: stable/train
    vars: *sc010_vars

- job:
    name: tripleo-ci-centos-8-scenario010-ovn-provider-standalone-train
    parent: tripleo-ci-scenario010-ovn-provider-standalone-options

- job:
    name: tripleo-ci-centos-8-scenario010-ovn-provider-standalone-train
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: stable/train
    vars: *sc010_ovn_vars

- project-template:
    name: tripleo-standalone-multinode-ipa-pipeline
    queue: tripleo
    check:
      jobs:
        - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-standalone-on-multinode-ipa:
            files: &tls_ipa_files
              # tripleo-quickstart-extras
              - ^roles/.*multinode-ipa.*$
              - ^roles/standalone.*$
              - ^playbooks/multinode-standalone-ipa.yml.*$
              # tripleo-heat-templates
              - environments/ssl/tls-everywhere-endpoints-dns.yaml
              - environments/services/haproxy-public-tls-certmonger.yaml
              - environments/services/haproxy-public-tls-inject.yaml
              - environments/ssl/enable-internal-tls.yaml
              - environments/ssl/enable-internal-tls.j2.yaml
              - environments/ssl/enable-memcached-tls.yaml
              - environments/ssl/enable-tls.yaml
              - ci/environments/standalone-ipa.yaml
              - deployment/ipa/ipaservices-baremetal-ansible.yaml
              - deployment/apache/*
              - deployment/cinder/*
              - deployment/database/*
              - deployment/glance/*
              - deployment/haproxy/*
              - deployment/horizon/*
              - deployment/keystone/*
              - deployment/memcached/*
              - deployment/neutron/*
              - deployment/nova/*
              - deployment/ovn/*
              - deployment/placement/*
              - deployment/rabbitmq/*
              - deployment/swift/*
              - deployment/timesync/*
              # puppet
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/database/mysql.*.pp$
              - ^manifests/profile/(base|pacemaker)/haproxy.*.pp$
              - ^manifests/profile/(base|pacemaker)/rabbitmq.*.pp$
              - tripleo_ipa
            vars: &ipa_consumer_vars
              consumer_job: true
              build_container_images: false
              remove_tags:
                - build
            dependencies:
              - tripleo-ci-centos-9-content-provider
    gate:
      jobs:
        - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-standalone-on-multinode-ipa:
            files: *tls_ipa_files
            vars: *ipa_consumer_vars
            dependencies:
              - tripleo-ci-centos-9-content-provider


- job:
    name: tripleo-ci-standalone-on-multinode-ipa-options
    vars: &multinode_ipa_job_vars
      featureset: '052'
      enable_tls: true
      playbooks:
        - quickstart.yml
        - multinode-standalone-ipa.yml
        - multinode-standalone.yml
      featureset_override:
        standalone_environment_files:
          - environments/ssl/tls-everywhere-endpoints-dns.yaml
          - environments/services/haproxy-public-tls-certmonger.yaml
          - environments/ssl/enable-internal-tls.yaml
          - environments/ssl/enable-memcached-tls.yaml
          - ci/environments/standalone-ipa.yaml
        tempest_tempest_conf_overrides:
          service-clients.http_timeout: '120'

- job:
    name: tripleo-ci-centos-9-standalone-on-multinode-ipa
    parent: tripleo-ci-base-standalone-centos-9
    branches: *c9_branches
    nodeset: two-centos-9-nodes
    required-projects:
      - opendev.org/x/tripleo-ipa
    roles:
      - zuul: opendev.org/x/tripleo-ipa

- job:
    name: tripleo-ci-centos-9-standalone-on-multinode-ipa
    branches: *c9_branches
    parent: tripleo-ci-standalone-on-multinode-ipa-options


- job:
    name: tripleo-ci-centos-8-repoclosure
    parent: tripleo-ci-base-standalone-centos-8
    branches: master  # this is only wired up in t-q-e
    vars:
      featureset: '052'
      repoclosure: true
      playbooks:
        - quickstart.yml
        - multinode-standalone-repoclosure.yml

# Ceph nightly jobs run periodically against
# pending bits
- job:
    name: tripleo-ci-centos-9-scenario001-ceph-nightly
    parent: tripleo-ci-centos-9-scenario001-standalone
    files: *scen1_files
    vars: &ceph_nightly_vars
      standalone_container_ceph_updates: true
      docker_ceph_namespace: quay.io/ceph
      docker_ceph_image: daemon
      docker_ceph_tag: latest-quincy

- job:
    name: tripleo-ci-centos-9-scenario004-ceph-nightly
    parent: tripleo-ci-centos-9-scenario004-standalone
    files: *scen4_files
    vars: *ceph_nightly_vars

- job:
    name: tripleo-ci-centos-9-scenario001-ceph-nightly-wallaby
    parent: tripleo-ci-centos-9-scenario001-ceph-nightly
    branches: master
    override-checkout: stable/wallaby
    vars: &ceph_nightly_wallaby_vars
      branch_override: stable/wallaby
      docker_ceph_tag: latest-pacific

- job:
    name: tripleo-ci-centos-9-scenario004-ceph-nightly-wallaby
    parent: tripleo-ci-centos-9-scenario004-ceph-nightly
    branches: master
    override-checkout: stable/wallaby
    vars: *ceph_nightly_wallaby_vars

##################################
# Standalone Upgrade distro jobs #
##################################

- job:
    name: tripleo-ci-standalone-upgrade-centos-8
    parent: tripleo-ci-base-standalone-upgrade-standard
    nodeset: single-centos-8-node
    branches: *c8_branches

- job:
    name: tripleo-ci-standalone-upgrade-centos-9
    parent: tripleo-ci-base-standalone-upgrade-standard
    nodeset: single-centos-9-node
    branches: *c9_branches

########################################################
# standalone-full-tempest-scenario & - api options job #
# ######################################################

- job:
    name: tripleo-ci-standalone-full-tempest-scenario-options
    vars:
      featureset: '052'
      featureset_override:
        tempest_run_concurrency: 4
        tempest_services: &tempest_services
          - cinder
          - horizon
          - neutron
        tempest_test_whitelist:
          - 'scenario'

- job:
    name: tripleo-ci-standalone-full-tempest-api-options
    vars:
      featureset: '052'
      featureset_override:
        tempest_run_concurrency: 4
        tempest_services: *tempest_services
        tempest_test_whitelist:
          - 'api'

### CentOS-9 FIPS Jobs
- job:
    name: tripleo-ci-centos-9-standalone-fips
    parent: tripleo-ci-centos-9-standalone
    vars: &fips_vars
      enable_fips: true
      nslookup_target: 'opendev.org'
      featureset_override:
        enable_fips: true
        standalone_environment_files:
          - 'environments/fips.yaml'
        tempest_tempestconf_profile_overrides:
          validation.ssh_key_type: 'ecdsa'

- job:
    name: tripleo-ci-centos-9-scenario001-standalone-fips
    parent: tripleo-ci-centos-9-scenario001-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario002-standalone-fips
    parent: tripleo-ci-centos-9-scenario002-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario002-standalone.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario003-standalone-fips
    parent: tripleo-ci-centos-9-scenario003-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario003-standalone.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario004-standalone-fips
    parent: tripleo-ci-centos-9-scenario004-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
          - 'environments/podman.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario007-standalone-fips
    parent: tripleo-ci-centos-9-scenario007-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario007-standalone.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario010-standalone-fips
    parent: tripleo-ci-centos-9-scenario010-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'
          - 'ci/environments/octavia-kvm.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario010-ovn-provider-standalone-fips
    parent: tripleo-ci-centos-9-scenario010-ovn-provider-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'
          - 'environments/fips.yaml'

- job:
    name: tripleo-ci-centos-9-scenario012-standalone-fips
    parent: tripleo-ci-centos-9-scenario012-standalone
    vars:
      <<: *fips_vars
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario012-standalone.yaml'
          - 'environments/fips.yaml'

### CentOS-9 FIPS Jobs - stable/zed

- job:
    name: tripleo-ci-centos-9-standalone-fips-zed
    parent: tripleo-ci-centos-9-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario001-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario001-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario002-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario002-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario003-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario003-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario004-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario004-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario007-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario007-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario010-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario010-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario010-ovn-provider-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario010-ovn-provider-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

- job:
    name: tripleo-ci-centos-9-scenario012-standalone-fips-zed
    parent: tripleo-ci-centos-9-scenario012-standalone-fips
    branches: master
    override-checkout: stable/zed
    vars:
      branch_override: stable/zed

### CentOS-9 FIPS Jobs - stable/wallaby

- job:
    name: tripleo-ci-centos-9-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario001-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario001-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario002-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario002-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario003-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario003-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario004-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario004-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario007-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario007-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario010-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario010-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario010-ovn-provider-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario010-ovn-provider-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

- job:
    name: tripleo-ci-centos-9-scenario012-standalone-fips-wallaby
    parent: tripleo-ci-centos-9-scenario012-standalone-fips
    branches: master
    override-checkout: stable/wallaby
    vars:
      branch_override: stable/wallaby

# Jobs for testing external data plane management

- job:
    name: tripleo-ci-centos-9-standalone-external-compute-target-host
    parent: tripleo-ci-base-edpm-centos-9
    branches:
      - master
      - stable/zed

- project-template:
    name: tripleo-external-compute-deployment-pipeline
    queue: tripleo
    check:
      jobs:
        - tripleo-ci-centos-9-standalone-external-compute-target-host: &compute_vars
            irrelevant-files: *irrelevant_files
            files: &compute_files
              # tripleo-ansible
              - ^tripleo_ansible/roles/.*
              - ^tripleo_ansible/playbooks/.*
              - ^tripleo_ansible/inventory/.*
              - scripts/tripleo-standalone-vars
              # tripleo-quickstart-extras
              - ^roles/external-data-plane-management/.*
              - playbooks/deploy-standalone-compute.yml
              # tripleo-quickstart
              - config/general_config/featureset053.yml
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-content-provider
    gate:
      jobs:
        - tripleo-ci-centos-9-content-provider
        - tripleo-ci-centos-9-standalone-external-compute-target-host: *compute_vars
