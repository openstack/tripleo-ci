---
# zuul.d/standalone-jobs.yaml
# Zuul layout for TripleO standalone jobs.
# It contains all the jobs related to standalone installer testing.

- job:
    name: tripleo-ci-centos-7-standalone
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      featureset: '052'
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^test-requirements.txt$
      - ^spec/.*$
      - ^Puppetfile.*$
      - tox.ini
      - ^vars/sova-patterns.yml$
      # like parent but with requirements.txt and setup.py removed

- job:
    name: tripleo-ci-centos-8-standalone
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^test-requirements.txt$
      - ^spec/.*$
      - ^Puppetfile.*$
      - tox.ini
      - ^vars/sova-patterns.yml$
      # like parent but with requirements.txt and setup.py removed

- job:
    name: tripleo-ci-centos-8-standalone-build
    parent: tripleo-ci-centos-8-standalone
    vars:
      build_container_images: true
    files:
      - config/release/tripleo-ci/.*
      - roles/standalone/.*
      - roles/build-containers/.*
      - roles/container-build/.*
      - roles/container-prep/.*
      - roles/container-update/.*
      - roles/extras-common/.*

# This job is rocky only!
# os_tempest needs updates rocky, that's WIP
- job:
    name: tripleo-ci-centos-7-standalone-rocky
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: stable/rocky
    vars:
      featureset: '052'
      featureset_override:
        tempest_format: container
        use_os_tempest: false
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^test-requirements.txt$
      - ^spec/.*$
      - ^Puppetfile.*$
      - tox.ini
      - ^vars/sova-patterns.yml$

- job:
    name: tripleo-ci-centos-7-standalone-upgrade
    parent: tripleo-ci-base-standalone-upgrade
    nodeset: single-centos-7-node
    voting: false
    branches: ^master$
    vars:
      featureset: '056'
    irrelevant-files: &upgrade_irrelevant
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^test-requirements.txt$
      - ^spec/.*$
      - ^Puppetfile.*$
      - tox.ini
      - ^vars/sova-patterns.yml$
      # like parent but with requirements.txt and setup.py removed

- job:
    name: tripleo-ci-centos-7-standalone-upgrade-stein
    parent: tripleo-ci-base-standalone-upgrade
    voting: true
    branches: ^stable/stein$
    override-checkout: 'stable/stein'
    vars:
      featureset: '056'
      branch_override: 'stable/stein'
    irrelevant-files: *upgrade_irrelevant

- job:
    name: tripleo-ci-centos-7-standalone-upgrade-train
    parent: tripleo-ci-base-standalone-upgrade
    voting: false
    branches: ^stable/train$
    override-checkout: 'stable/train'
    vars:
      featureset: '056'
      branch_override: 'stable/train'
    irrelevant-files: *upgrade_irrelevant

- job:
    name: tripleo-ci-centos-8-standalone-upgrade
    parent: tripleo-ci-base-standalone-upgrade-centos-8
    voting: false
    branches: ^master$
    vars:
      featureset: '056'
    irrelevant-files: *upgrade_irrelevant

# docker-ha, podman env files https://bugs.launchpad.net/tripleo/+bug/1887159
- job:
    name: tripleo-ci-centos-8-standalone-upgrade-ussuri
    parent: tripleo-ci-base-standalone-upgrade-centos-8
    voting: false
    branches: ^stable/ussuri$
    override-checkout: 'stable/ussuri'
    vars:
      featureset: '056'
      branch_override: 'stable/ussuri'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'environments/docker-ha.yaml'
          - 'environments/podman.yaml'
    irrelevant-files: *upgrade_irrelevant

- project-template:
    name: tripleo-standalone-scenarios-full
    check:
      jobs:
        - tripleo-ci-centos-8-scenario001-standalone:
            files: &scen1_files
              # tripleo-common
              - ^container-images/.*$
              - tripleo_common/image/kolla_builder.py
              - workbooks/ceph-ansible.yaml
              - tripleo_common/actions/ansible.py
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*aodh.*$
              - ^((docker|puppet)/services|deployment)/.*ceilometer.*$
              - ^((docker|puppet)/services|deployment)/.*ceph.*$
              - ^((docker|puppet)/services|deployment)/.*cinder.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*gnocchi.*$
              - ^((docker|puppet)/services|deployment)/.*logging.*$
              - ^((docker|puppet)/services|deployment)/.*metrics.*$
              - ^((docker|puppet)/services|deployment)/.*monitoring.*$
              - ^((docker|puppet)/services|deployment)/.*panko.*$
              - ^((docker|puppet)/services|deployment)/database/redis.*$
              - deployment/ovn/.*
              - ci/environments/scenario001-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/certmonger/ceph.*$ # ceph dashboard
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/aodh.*$
              - ^manifests/profile/(base|pacemaker)/ceilometer.*$
              - ^manifests/profile/(base|pacemaker)/cinder.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/gnocchi.*$
              - ^manifests/profile/(base|pacemaker)/logging.*$
              - ^manifests/profile/(base|pacemaker)/metrics.*$
              - ^manifests/profile/(base|pacemaker)/monitoring.*$
              - ^manifests/profile/(base|pacemaker)/panko.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/common/.*
              - roles/prepare-node/.*
              - roles/ceph-loop-device/.* # scen1/4 ceph
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
        - tripleo-ci-centos-8-scenario002-standalone:
            files: &scen2_files
              # tripleo-common
              - ^container-images/.*$
              - tripleo_common/image/kolla_builder.py
              - workbooks/ceph-ansible.yaml
              - tripleo_common/actions/ansible.py
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*aodh.*$
              - ^((docker|puppet)/services|deployment)/.*barbican.*$
              - ^((docker|puppet)/services|deployment)/.*ceilometer.*$
              - ^((docker|puppet)/services|deployment)/.*cinder.*$
              - ^((docker|puppet)/services|deployment)/.*ec2-api.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*gnocchi.*$
              - ^((docker|puppet)/services|deployment)/.*panko.*$
              - ^((docker|puppet)/services|deployment)/.*swift.*$
              - ^((docker|puppet)/services|deployment)/.*zaqar.*$
              - ^((docker|puppet)/services|deployment)/database/redis.*$
              - deployment/ovn/.*
              - ci/environments/scenario002-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/profile/(base|pacemaker)/aodh.*$
              - ^manifests/profile/(base|pacemaker)/barbican.*$
              - ^manifests/profile/(base|pacemaker)/ceilometer.*$
              - ^manifests/profile/(base|pacemaker)/cinder.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/gnocchi.*$
              - ^manifests/profile/(base|pacemaker)/nova/ec2.*$
              - ^manifests/profile/(base|pacemaker)/panko.*$
              - ^manifests/profile/(base|pacemaker)/swift.*$
              - ^manifests/profile/(base|pacemaker)/zaqar.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/prepare-node/.*
              - roles/common/.*
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
        - tripleo-ci-centos-8-scenario003-standalone:
            files: &scen3_files
              # tripleo-common
              - ^container-images/.*$
              - tripleo_common/image/kolla_builder.py
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*designate.*$
              - ^((docker|puppet)/services|deployment)/.*glance.*$
              - ^((docker|puppet)/services|deployment)/.*mistral.*$
              - ^((docker|puppet)/services|deployment)/.*nova.*$
              - ^((docker|puppet)/services|deployment)/.*sahara.*$
              - deployment/ovn/.*
              - ci/environments/scenario003-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/mistral.*$
              - ^manifests/profile/(base|pacemaker)/sahara.*$
              - ^manifests/profile/(base|pacemaker)/designate.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/common/.*
              - roles/prepare-node/.*
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
        - tripleo-ci-centos-8-scenario004-standalone:
            files: &scen4_files
              # tripleo-common
              - workbooks/ceph-ansible.yaml
              - ^container-images/.*$
              - tripleo_common/actions/ansible.py
              - tripleo_common/image/kolla_builder.py
              # tripleo-heat-templates
              - ^(docker/services|deployment)/ceph.*$
              - ^(docker/services|deployment)/glance.*$
              - ^(docker/services|deployment)/manila.*$
              - ^((docker|puppet)/services|deployment)/database/mysql.*$
              - deployment/ovn/.*
              - ci/environments/scenario004-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              - ^manifests/profile/(base|pacemaker)/manila.*$
              - ^manifests/profile/(base|pacemaker)/ceph.*$ # ceph_nfs / ganesha
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/common/.*
              - roles/prepare-node/.*
              - roles/ceph-loop-device/.* # scen1/4 ceph
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
        - tripleo-ci-centos-8-scenario010-standalone:
            files: &scen10_files
              # tripleo-common
              - workbooks/octavia_post.yaml
              - playbooks/octavia-files.yaml
              - playbooks/roles/octavia.*$
              - playbooks/roles/common/.*$
              - ^container-images/.*$
              - tripleo_common/actions/ansible.py
              - tripleo_common/image/kolla_builder.py
              # tripleo-quickstart
              - config/general_config/featureset062.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/base/database/mysql.*$
              - ^manifests/profile/base/octavia.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
                roles/octavia-amphora-download/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/common/.*
              - roles/prepare-node/.*
              # tripleo-heat-templates
              # TODO(beagles): octavia testing touches neutron, glance and nova.
              # It may be sensible to expand this list after it has proven itself.
              - ^(docker/services|deployment)/octavia.*$
              - ci/environments/scenario010-standalone.yaml
              - ^environments\services/octavia.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
              # python-tempestconf
              - ^config_tempest/services/octavia.*$

        - tripleo-ci-centos-7-scenario010-standalone:
            files: *scen10_files

        - tripleo-ci-centos-7-scenario010-ovn-provider-standalone:
            files: *scen10_files

        - tripleo-ci-centos-8-scenario010-ovn-provider-standalone:
            files: *scen10_files

        - tripleo-ci-centos-8-scenario012-standalone:
            files: &scen12_files
              # tripleo-common
              - ^container-images/.*$
              - tripleo_common/actions/ansible.py
              - tripleo_common/image/kolla_builder.py
              # tripleo-heat-templates
              - ^(docker/services|deployment)/glance.*$
              - ^(docker/services|deployment)/ironic.*$
              - ci/environments/scenario012-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset060.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
              - ^manifests/profile/(base|pacemaker)/glance.*$
              # tripleo-quickstart-extras
              - roles/standalone/.*
              - roles/validate-tempest/.*
              # tripleo-ci
              - roles/run-test/.*
              - roles/common/.*
              - roles/prepare-node/.*
              - roles/ceph-loop-device/.* # scen1/4 ceph
              # python-tripleoclient
              - ^tripleoclient/heat_launcher.*$
              - ^tripleoclient/v1/tripleo_(deploy|config|upgrade).*$
        - tripleo-ci-centos-8-scenario007-standalone:
            files: &scen7_files
              # tripleo-common
              - workbooks/ceph-ansible.yaml
              - ^container-images/.*$
              - tripleo_common/actions/ansible.py
              - tripleo_common/image/kolla_builder.py
              # tripleo-heat-templates
              - ^((docker|puppet)/services|deployment)/.*neutron.*$
              - ci/environments/scenario007-standalone.yaml
              - ^environments\/.*.yaml
              - ^deployed-server/.*$
              - ^network/endpoints/.*$
              - ^common/.*$
              # tripleo-quickstart
              - config/general_config/featureset052.yml
              # puppet-tripleo
              - ^manifests/haproxy.*$
        - tripleo-ci-centos-7-standalone-rocky
        - tripleo-ci-centos-8-standalone-upgrade:
            irrelevant-files: &sa_upgrade_ignore
              - zuul.d/build-containers.yaml
              - zuul.d/build-image.yaml
              - zuul.d/multinode-jobs.yaml
              - zuul.d/undercloud-jobs.yaml
              - zuul.d/ansible.yaml
        - tripleo-ci-centos-8-standalone-upgrade-ussuri:
            irrelevant-files: *sa_upgrade_ignore
        - tripleo-ci-centos-7-standalone-upgrade-stein
        - tripleo-ci-centos-7-standalone-upgrade-train
        - tripleo-ci-centos-8-standalone
        - tripleo-ci-centos-8-standalone-build
        - tripleo-ci-centos-7-standalone
        - tripleo-ci-centos-7-scenario001-standalone:
            files: *scen1_files
        - tripleo-ci-centos-7-scenario002-standalone:
            files: *scen2_files
        - tripleo-ci-centos-7-scenario003-standalone:
            files: *scen3_files
        - tripleo-ci-centos-7-scenario004-standalone:
            files: *scen4_files

    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-7-scenario001-standalone:
            files: *scen1_files
        - tripleo-ci-centos-7-scenario002-standalone:
            files: *scen2_files
        - tripleo-ci-centos-7-scenario003-standalone:
            files: *scen3_files
        - tripleo-ci-centos-7-scenario004-standalone:
            files: *scen4_files
        - tripleo-ci-centos-8-scenario001-standalone:
            files: *scen1_files
        - tripleo-ci-centos-8-scenario002-standalone:
            files: *scen2_files
        - tripleo-ci-centos-8-scenario003-standalone:
            files: *scen3_files
        - tripleo-ci-centos-8-scenario004-standalone:
            files: *scen4_files
        - tripleo-ci-centos-8-scenario007-standalone:
            files: *scen7_files
        - tripleo-ci-centos-7-standalone-upgrade-stein
        - tripleo-ci-centos-7-standalone
        - tripleo-ci-centos-8-standalone
        - tripleo-ci-centos-8-standalone-build

        - tripleo-ci-centos-7-scenario010-standalone:
            files: *scen10_files
        - tripleo-ci-centos-8-scenario012-standalone:
            files: *scen12_files

- project-template:
    name: tripleo-standalone-scenarios-pipeline
    check:
      jobs:
        - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario001-standalone:
            files: *scen1_files
            vars: &consumer_vars
              consumer_job: true
              build_container_images: false
              tags:
                - standalone
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario002-standalone:
            files: *scen2_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario003-standalone:
            files: *scen3_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario004-standalone:
            files: *scen4_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario007-standalone:
            files: *scen7_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario010-standalone:
            files: *scen10_files
            vars:
              consumer_job: true
              build_container_images: false
              tags:
                - standalone
                - octavia
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario010-ovn-provider-standalone:
            files: *scen10_files
            vars:
              consumer_job: true
              build_container_images: false
              tags:
                - standalone
                - octavia
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario012-standalone:
            files: *scen12_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-standalone:
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider

        # Keep CentOS 7 job as usual
        - tripleo-ci-centos-7-scenario010-standalone:
            files: *scen10_files
        - tripleo-ci-centos-7-scenario010-ovn-provider-standalone:
            files: *scen10_files
        - tripleo-ci-centos-7-standalone-rocky
        - tripleo-ci-centos-8-standalone-upgrade:
            irrelevant-files: *sa_upgrade_ignore
        - tripleo-ci-centos-8-standalone-upgrade-ussuri:
            irrelevant-files: *sa_upgrade_ignore
        - tripleo-ci-centos-7-standalone-upgrade-stein
        - tripleo-ci-centos-7-standalone-upgrade-train
        - tripleo-ci-centos-7-standalone
        - tripleo-ci-centos-7-scenario001-standalone:
            files: *scen1_files
        - tripleo-ci-centos-7-scenario002-standalone:
            files: *scen2_files
        - tripleo-ci-centos-7-scenario003-standalone:
            files: *scen3_files
        - tripleo-ci-centos-7-scenario004-standalone:
            files: *scen4_files

    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario001-standalone:
            files: *scen1_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario002-standalone:
            files: *scen2_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario003-standalone:
            files: *scen3_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario004-standalone:
            files: *scen4_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario007-standalone:
            files: *scen7_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-scenario012-standalone:
            files: *scen12_files
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-standalone:
            vars: *consumer_vars
            dependencies:
              - tripleo-ci-centos-8-content-provider

        # Keep CentOS 7 jobs as usual
        - tripleo-ci-centos-7-scenario001-standalone:
            files: *scen1_files
        - tripleo-ci-centos-7-scenario002-standalone:
            files: *scen2_files
        - tripleo-ci-centos-7-scenario003-standalone:
            files: *scen3_files
        - tripleo-ci-centos-7-scenario004-standalone:
            files: *scen4_files
        - tripleo-ci-centos-7-standalone-upgrade-stein
        - tripleo-ci-centos-7-standalone-upgrade-train
        - tripleo-ci-centos-7-standalone
        - tripleo-ci-centos-7-scenario010-standalone:
            files: *scen10_files

- job:
    name: tripleo-ci-centos-7-scenario001-standalone
    voting: true
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
        tempest_services:
          - aodh
        tempest_run_concurrency: 1
        tempest_tempest_conf_overrides:
          'telemetry.alarm_granularity': '60'
        tempest_test_whitelist:
          - 'tempest.api.identity.v3'
          - 'tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern.test_volume_boot_pattern'
          - 'tempest.scenario.test_snapshot_pattern.TestSnapshotPattern.test_snapshot_pattern'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: tripleo-ci-centos-7-scenario002-standalone
    voting: true
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario002-standalone.yaml'
        tempest_services:
          - barbican
          - ceilometer
          - aodh
        tempest_tempest_conf_overrides:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_extra_config:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_test_whitelist:
          - 'tempest.api.object_storage.test_object_services.ObjectTest'
          - 'barbican_tempest_plugin.tests.scenario.test_volume_encryption.VolumeEncryptionTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningSnapshotTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningTest.test_signed_image_upload_and_boot'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: tripleo-ci-centos-7-scenario003-standalone
    voting: true
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario003-standalone.yaml'
        tempest_services:
          - mistral
          - sahara
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'sahara_tempest_plugin.tests.api.test_data_sources.DataSourceTest'
          - 'mistral_tempest_tests.tests.api.v2.test_actions.ActionTestsV2'

- job:
    name: tripleo-ci-centos-7-scenario004-standalone
    voting: true
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_container_cli: docker
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
        tempest_services:
          - manila
        tempest_tempest_conf_overrides:
          'share.multitenancy_enabled': 'False'
          'share.enable_protocols': 'cephfs'
          'share.capability_snapshot_support': 'False'
          'share.capability_create_share_from_snapshot_support': 'False'
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'manila_tempest_tests.tests.api.test_shares.SharesCephFSTest.test_create_get_delete_share'

- job:
    name: tripleo-ci-centos-7-scenario010-standalone
    voting: true
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      tags:
        - build
        - standalone
        - octavia
      featureset: '062'
      standalone_ceph: true
      tempest_workers: 1
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: tripleo-ci-centos-7-scenario010-ovn-provider-standalone
    voting: false
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^(stable/(stein)).*$
    vars:
      tags:
        - build
        - standalone
        - octavia
      featureset: '062'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        tempest_tempestconf_profile_overrides:
          load_balancer.provider: 'ovn'
          load_balancer.member_role: '"Member"'
          load_balancer.test_with_ipv6: false
          load_balancer.test_reuse_connection: false
          load_balancer.load_balancing_algorithm: 'SOURCE_IP_PORT'
          load_balancer.test_flavors: false
          loadbalancer-feature-enabled.health_monitor_enabled: false
          loadbalancer-feature-enabled.pool_algorithms_enabled: false
          loadbalancer-feature-enabled.l7_protocol_enabled: false
          loadbalancer-feature-enabled.l4_protocol: 'TCP'
          loadbalancer-feature-enabled.session_persistence_enabled: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: tripleo-ci-centos-8-scenario012-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '060'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario012-standalone.yaml'

- job:
    name: tripleo-ci-centos-7-standalone-os-tempest
    parent: tripleo-ci-base-standalone
    nodeset: single-centos-7-node
    branches: ^stable/stein$
    vars:
      featureset: '052'
      featureset_override:
        use_os_tempest: true
        tempest_tempest_conf_overrides:
          auth.use_dynamic_credentials: true
        tempest_test_whitelist:
          - 'tempest.api.identity.v3'
          - 'tempest.scenario.test_server_basic_ops'
          - 'tempest.api.volume.admin.test_multi_backend'
          - 'tempest.scenario.test_object_storage_basic_ops'

# CentOS 8 Jobs
- job:
    name: tripleo-ci-centos-8-scenario001-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
        tempest_services:
          - aodh
        tempest_run_concurrency: 1
        tempest_tempest_conf_overrides:
          'telemetry.alarm_granularity': '60'
        tempest_test_whitelist:
          - 'tempest.api.identity.v3'
          - 'tempest.scenario.test_volume_boot_pattern.TestVolumeBootPattern.test_volume_boot_pattern'
          - 'tempest.scenario.test_snapshot_pattern.TestSnapshotPattern.test_snapshot_pattern'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: tripleo-ci-centos-8-scenario002-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario002-standalone.yaml'
        tempest_services:
          - barbican
          - ceilometer
          - aodh
        tempest_tempest_conf_overrides:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_extra_config:
          auth.tempest_roles: "'Member, creator'"
          telemetry.alarm_granularity: '60'
        tempest_test_whitelist:
          - 'tempest.api.object_storage.test_object_services.ObjectTest'
          - 'barbican_tempest_plugin.tests.scenario.test_volume_encryption.VolumeEncryptionTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningSnapshotTest'
          - 'barbican_tempest_plugin.tests.scenario.test_image_signing.ImageSigningTest.test_signed_image_upload_and_boot'
          - 'telemetry_tempest_plugin.scenario.test_telemetry_integration.TestTelemetryIntegration'

- job:
    name: tripleo-ci-centos-8-scenario003-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario003-standalone.yaml'
        tempest_services:
          - mistral
          - sahara
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'sahara_tempest_plugin.tests.api.test_data_sources.DataSourceTest'
          - 'mistral_tempest_tests.tests.api.v2.test_actions.ActionTestsV2'

- job:
    name: tripleo-ci-centos-8-scenario004-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
      standalone_ceph: true
      featureset_override:
        standalone_container_cli: podman
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
          - 'environments/podman.yaml'
        tempest_services:
          - manila
        tempest_tempest_conf_overrides:
          'share.multitenancy_enabled': 'False'
          'share.enable_protocols': 'cephfs'
          'share.capability_snapshot_support': 'False'
          'share.capability_create_share_from_snapshot_support': 'False'
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'manila_tempest_tests.tests.api.test_shares.SharesCephFSTest.test_create_get_delete_share'

- job:
    name: tripleo-ci-centos-8-scenario007-standalone
    voting: true
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      featureset: '052'
      featureset_override:
        run_tempest: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario007-standalone.yaml'
        tempest_services:
          - neutron
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
        tempest_private_net_provider_type: 'vxlan'
        use_os_tempest: true

- job:
    name: tripleo-ci-centos-8-scenario010-standalone
    voting: false
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      tags:
        - build
        - standalone
        - octavia
      # using featureset062 is tech debt and should be addressed at a future sprint
      featureset: '062'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: tripleo-ci-centos-8-scenario010-ovn-provider-standalone
    voting: false
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    vars:
      tags:
        - build
        - standalone
        - octavia
      featureset: '062'
      standalone_ceph: true
      featureset_override:
        validate_services: false
        tempest_tempestconf_profile_overrides:
          load_balancer.provider: 'ovn'
          load_balancer.member_role: '"Member"'
          load_balancer.test_with_ipv6: false
          load_balancer.test_reuse_connection: false
          load_balancer.load_balancing_algorithm: 'SOURCE_IP_PORT'
          load_balancer.test_flavors: false
          loadbalancer-feature-enabled.health_monitor_enabled: false
          loadbalancer-feature-enabled.pool_algorithms_enabled: false
          loadbalancer-feature-enabled.l7_protocol_enabled: false
          loadbalancer-feature-enabled.l4_protocol: 'TCP'
          loadbalancer-feature-enabled.session_persistence_enabled: false
          loadbalancer-feature-enabled.not_implemented_is_error: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- project-template:
    name: tripleo-standalone-multinode-ipa
    check:
      jobs:
        - tripleo-ci-centos-8-standalone-on-multinode-ipa:
            files: &tls_ipa_files
              # tripleo-quickstart-extras
              - ^roles/.*multinode-ipa.*$
              - ^roles/standalone.*$
              - ^playbooks/multinode-standalone-ipa.yml.*$
              # tripleo-heat-templates
              - environments/ssl/tls-everywhere-endpoints-dns.yaml
              - environments/services/haproxy-public-tls-certmonger.yaml
              - environments/services/haproxy-public-tls-inject.yaml
              - environments/ssl/enable-internal-tls.yaml
              - environments/ssl/enable-internal-tls.j2.yaml
              - environments/ssl/enable-tls.yaml
              - ci/environments/standalone-ipa.yaml
              - deployment/ipa/ipaservices-baremetal-ansible.yaml
              - deployment/apache/*
              - deployment/ceph-ansible/*
              - deployment/database/*
              - deployment/etcd/*
              - deployment/haproxy/*
              - deployment/metrics/*
              - deployment/neutron/*
              - deployment/nova/*
              - deployment/octavia/*
              - deployment/ovn/*
              - deployment/rabbitmq/*
              # puppet
              - manifests/profile/base/rabbitmq.pp

- project-template:
    name: tripleo-standalone-multinode-ipa-pipeline
    check:
      jobs:
        - tripleo-ci-centos-8-content-provider
        - tripleo-ci-centos-8-standalone-on-multinode-ipa:
            files: *tls_ipa_files
            vars: &ipa_consumer_vars
              consumer_job: true
              build_container_images: false
              tags:
                - standalone
            dependencies:
              - tripleo-ci-centos-8-content-provider

- job:
    name: tripleo-ci-centos-8-standalone-on-multinode-ipa
    parent: tripleo-ci-base-standalone-centos-8
    voting: false
    nodeset: two-centos-8-nodes
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    required-projects:
      - opendev.org/x/tripleo-ipa
    roles:
      - zuul: opendev.org/x/tripleo-ipa
    vars:
      featureset: '052'
      enable_tls: true
      playbooks:
        - quickstart.yml
        - multinode-standalone-ipa.yml
        - multinode-standalone.yml
      featureset_override:
        standalone_environment_files:
          - environments/ssl/tls-everywhere-endpoints-dns.yaml
          - environments/services/haproxy-public-tls-certmonger.yaml
          - environments/ssl/enable-internal-tls.yaml
          - ci/environments/standalone-ipa.yaml
        tempest_tempest_conf_overrides:
          service-clients.http_timeout: '120'

- job:
    name: tripleo-ci-centos-8-content-provider
    parent: tripleo-ci-base-standalone-centos-8
    branches: ^(?!stable/(newton|ocata|pike|queens|rocky|stein)).*$
    run:
      - playbooks/tripleo-ci/run-v3.yaml
      - playbooks/tripleo-ci/run-provider.yml
    vars:
      featureset: '052'
      provider_job: true
      build_container_images: true
      ib_create_web_repo: true
      playbooks:
        - quickstart.yml
        - multinode-standalone-pre.yml

- job:
    name: tripleo-ci-centos-8-content-provider-ussuri
    parent: tripleo-ci-centos-8-content-provider
    override-checkout: stable/ussuri
    vars:
      branch_override: stable/ussuri

- job:
    name: tripleo-ci-centos-8-content-provider-train
    parent: tripleo-ci-centos-8-content-provider
    override-checkout: stable/train
    vars:
      branch_override: stable/train
